<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/LayoutCommon}">

<th:block layout:fragment="title">입출금 항목</th:block>

<!-- index.html 고유 CSS 추가 -->
<th:block layout:fragment="css">
</th:block>

<!-- index.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">

	<script type="text/javascript" th:inline="javascript">

	/*<![CDATA[*/
		const insertRes = /*[[${res}]]*/ null;
	/*]]>*/
 	$(function () {
 		
 		$('#DataTableCategory').DataTable({
	        "processing": false,
	        "paging": true,
		});
		
 		if( insertRes != null && insertRes.code != "0"){
 			toastr["error"]("오류", insertRes.code + ' - ' + insertRes.message);
 		}
 		
		const submitForm = document.querySelector("#FormCategory");
		submitForm.addEventListener("submit", saveInfo);
	});
	
	function saveInfo(event){
 		//여기서 자동 submit을 막아줍니다.
 		event.preventDefault(); 
 		
 		const isAdd = parseInt( $("#inputNo").val() ) < 0;
		const name = $("#txtName").val();
		
 		toastConfirm( isAdd? 'Add':'Modify', name + (isAdd? ' 추가':' 수정') + '하시겠습니까?', function(){
			event.target.submit();
		} );
	}
	
	function onClear(){
		$("#inputNo").val('-1');
		$("#txtName").val('');
		$("#selectCategoryType option:eq(0)").prop("selected", true);
	}
	
	function onClickList(row){
		
	    const cells = row.cells;

	    const data = {
	        no: row.getAttribute('no'),
	        cType: cells[0].getAttribute('ctype'),
	        name: cells[1].textContent,
	    };
	    
	    console.info(data);

		$("#inputNo").val(data.no);
		$("#txtName").val(data.name);
	    $("#selectCategoryType").val( data.cType ).prop("selected", true);
	}
	</script>

</th:block>

<div layout:fragment="content">
    <div class="card shadow mb-4">
           <form id="FormCategory" method="POST" th:action="@{/Config/Category/Home.html}" target="_self">
            <input type="hidden" name="no" id="inputNo" value="-1">
			<div class="row  border-bottom-success shadow">
			
				<div class="card-body">
					<div class="form-group">
						<label for="selectCategoryType">종류<font color="red">*</font></label>
						<select name="cType" class="form-control" id="selectCategoryType">
							<option th:each="item : ${cTypes}" th:value="${item}"
								th:text="${item.dscr}"></option>
						</select>
					</div>
				</div>
				
				<div class="card-body">
					<div class="form-group">
	                    <label for="txtName">이름<font color="red">*</font></label>
	                    <input type="text" class="form-control" id="txtName" name="name" placeholder="이름 입력" required>
					</div>
				</div>

				<div class="card-body">
					<div class="form-group">
		                <button type="button" class="btn btn-primary" onclick="onClear()">초기화</button>
		                <button type="submit" class="btn btn-primary">저장</button>
					</div>
				</div>
			</div>
        </form>
        
		<div class="card-body">
			<div class="table-responsive">
				<table class="table table-bordered" id="DataTableCategory">
					<thead>
						<tr>
							<th>종류</th>
							<th>이름</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="data : ${list}" th:attr="no=${data.no}" onclick="onClickList(this)">
							<td class="text-center" th:attr="ctype=${data.cType}" th:text="${data.cType.dscr}"></td>
							<td class="text-center" th:text="${data.name}"></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
    </div>
</div>

</html>